<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) We install 32 bit libraries on 32 and 64 bit, but 64 only on 64 bit
  2) This checking isn't really that good - on 64b we should check for both 32b and 64b instead of either one as now
  3) 2003 doesn't exist as a redistributable, so in order to get the files you need to do the following:
    a) Download from here: http://code.msdn.microsoft.com/KB932298
    b) Unpack using cabextract
    c) Rename msvcp71.dll and msvcr71.dll
  4) We really should make amd64/x86 directories instead of renaming files
-->

<packages>

<package
  id="vcruntime"
  name="Visual C++ Runtime 2005, 2008 and 2010"
  revision="7"
  reboot="false"
  priority="10">

  <check type="logical" condition="or">
    <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Visual C++ 2005 Redistributable"       value="8.0.56336" />
    <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Visual C++ 2005 Redistributable - x64" value="8.0.56336" />
  </check>
  <check type="logical" condition="or">
    <check type="uninstall" condition="exists" path="Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.17" />
    <check type="uninstall" condition="exists" path="Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.17" />
  </check>
  <check type="logical" condition="or">
    <check type="uninstall" condition="exists" path="Microsoft Visual C++ 2010  x86 Redistributable - 10.0.30319" />
    <check type="uninstall" condition="exists" path="Microsoft Visual C++ 2010  x64 Redistributable - 10.0.30319" />
  </check>

  <install cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <install cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <install cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <upgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <upgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <upgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <downgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>
  <downgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>
  <downgrade cmd='"%SOFTWARE%\Microsoft\VCRuntime\x86\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>

  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <install cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </install>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </upgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2005sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2008sp1.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\Microsoft\VCRuntime\amd64\vcredist_2010.exe" /Q /R:N'>
    <exit code="3010" />
  </downgrade>
</package>

<package
  id="vcruntime_2003"
  name="Visual C++ Runtime 2003 SP1"
  revision="1"
  reboot="false"
  priority="10">

  <check type="logical" condition="and">
    <check type="file" condition="versiongreaterorequal" path="%WINDIR%\msvcp71.dll" value="7.10.6052.0" />
    <check type="file" condition="versiongreaterorequal" path="%WINDIR%\msvcr71.dll" value="7.10.7031.4" />
  </check>

  <install   cmd='xcopy /Y "%SOFTWARE%\Microsoft\VCRuntime\x86\msvc?71.dll" "%WINDIR%"' />
  <upgrade   cmd='xcopy /Y "%SOFTWARE%\Microsoft\VCRuntime\x86\msvc?71.dll" "%WINDIR%"' />
  <downgrade cmd='xcopy /Y "%SOFTWARE%\Microsoft\VCRuntime\x86\msvc?71.dll" "%WINDIR%"' />
  <remove    cmd='%COMSPEC% /c del /Q /F "%WINDIR%\msvc?71.dll"' />
</package>

</packages>

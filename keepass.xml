<?xml version="1.0" encoding="UTF-8"?>

<packages>

<package
  id="keepass"
  name="KeePass"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="2.15" />
  <check type="uninstall" condition="exists" path="KeePass Password Safe %version%" />

  <install cmd='"%SOFTWARE%\KeePass\KeePass-%version%-Setup.exe" /VERYSILENT /sp-' />
  <install cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "KeePass 2 PreLoad" /f'>
    <exit code="2" />
  </install>

  <upgrade cmd='"%SOFTWARE%\KeePass\KeePass-%version%-Setup.exe" /VERYSILENT /sp-' />
  <upgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "KeePass 2 PreLoad" /f'>
    <exit code="2" />
  </upgrade>

  <downgrade cmd='"%SOFTWARE%\KeePass\KeePass-%version%-Setup.exe" /VERYSILENT /sp-' />
  <downgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "KeePass 2 PreLoad" /f'>
    <exit code="2" />
  </downgrade>

  <remove cmd='taskkill.exe /f /im keepass.exe'><exit code="any" /></remove>
  <!-- Windows 32-bit -->
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles%\KeePass Password Safe 2\unins000.exe" "%ProgramFiles%\KeePass Password Safe 2\unins000.exe" /VERYSILENT' />
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles%\KeePass Password Safe 2" REG ADD "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce" /v keepass /d "%COMSPEC% /c IF NOT EXIST \"%ProgramFiles%\KeePass Password Safe 2\keepass.exe\" RD /Q /S \"%ProgramFiles%\KeePass Password Safe 2\"" /f' />
  <!-- Windows 64-bit -->
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\KeePass Password Safe 2\unins000.exe" "%ProgramFiles(x86)%\KeePass Password Safe 2\unins000.exe" /VERYSILENT' />
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\KeePass Password Safe 2" REG ADD "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce" /v keepass /d "%COMSPEC% /c IF NOT EXIST \"%ProgramFiles(x86)%\KeePass Password Safe 2\keepass.exe\" RD /Q /S \"%ProgramFiles(x86)%\KeePass Password Safe 2\"" /f' />

</package>

</packages>

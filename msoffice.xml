<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) Upgrades do not work as running setup.exe when it's already installed WILL result in a prompt
  2) 2010 is the first to come in 32/64 bit versions. I need the CLSID id for the 32bit version verified.
-->

<packages>

<package
  id="office2010plus"
  name="MS Office Pro Plus 2010"
  revision="1"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="exists" path="Microsoft Office Professional Plus 2010" />

  <install cmd='%COMSPEC% /c IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%SOFTWARE%\MS Office Pro Plus 2010\setup.exe"'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </install>
  <install cmd='%COMSPEC% /c IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%SOFTWARE%\MS Office Pro Plus 2010-x64\setup.exe"'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </install>
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   msiexec %MSI% /x{91140000-0011-0000-0000-0000000FF1CE}'>
    <exit code="3010" />
  </remove>
  <remove  cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" msiexec %MSI% /x{91140000-0011-0000-1000-0000000FF1CE}'>
    <exit code="3010" />
  </remove>

</package>

<package
  id="office2007plus"
  name="MS Office Pro Plus 2007"
  revision="4"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="exists" path="Microsoft Office Professional Plus 2007" />

  <install cmd='"%SOFTWARE%\MS Office Pro Plus 2007 SP2\setup.exe"'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </install>

  <remove cmd="MsiExec.exe /X{90120000-0011-0000-0000-0000000FF1CE} %MSI%">
    <exit code="3010" />
  </remove>

</package>

<package
  id="office2007std"
  name="MS Office Standard 2007"
  revision="4"
  reboot="false"
  priority="10">

  <check type="uninstall" condition="exists" path="Microsoft Office Standard 2007" />

  <install cmd='"%SOFTWARE%\MS Office Std 2007 SP2\setup.exe"'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </install>

  <remove cmd="MsiExec.exe /X{90120000-0012-0000-0000-0000000FF1CE} %MSI%">
    <exit code="3010" />
  </remove>

</package>

<!--
  NOTES:
  1) Download FileFormatConverters and extract with /extract:<path>. Recent
     versions include up to SP2 in the MSI.
  2) Package uses MSI to uninstall, because the GUID depends on locale.
-->

<package
  id="office2007compatibility"
  name="Compatibility pack for Microsoft Office 2007 Formats"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="12.0.6514.5001" />

  <!-- Name differs depending on installed language, so check path instead -->
  <check type="logical" condition="or">
    <check type="file" condition="exists" path="%PROGRAMFILES%\Microsoft Office\Office12\Moc.exe" />
    <check type="file" condition="exists" path="%PROGRAMFILES(x86)%\Microsoft Office\Office12\Moc.exe" />
  </check>

  <install cmd='msiexec %MSI% /i "%SOFTWARE%\Microsoft\FileFormatConverters\O12Conv.msi"'>
    <exit code='1641' reboot="postponed" />
    <exit code='3010' reboot="postponed" />
  </install>

  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Microsoft\FileFormatConverters\O12Conv.msi"'>
    <exit code='1641' reboot="postponed" />
    <exit code='3010' reboot="postponed" />
  </upgrade>

  <downgrade cmd='msiexec %MSI% /i "%SOFTWARE%\Microsoft\FileFormatConverters\O12Conv.msi"'>
    <exit code='1641' reboot="postponed" />
    <exit code='3010' reboot="postponed" />
  </downgrade>

  <remove cmd='msiexec %MSI% /X "%SOFTWARE%\Microsoft\FileFormatConverters\O12Conv.msi"'>
    <exit code='3010' />
  </remove>
</package>

<package
  id="office2000pro"
  name="MS Office 2000 Professional"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <!-- Version number from setup.exe -->
  <variable name="version" value="9.0.0.2611" />

  <check type="uninstall" condition="exists" path="Microsoft Office 2000 Professional" />

  <!-- Use Microsoft Office 2000 Resource Kit Tools to generate a transform -->
  <install cmd='"%SOFTWARE%\Office2000\setup.exe" TRANSFORMS="%SOFTWARE%\Office2000\custom.mst" /wait /qn'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </install>

  <upgrade cmd='"%SOFTWARE%\Office2000\setup.exe" TRANSFORMS="%SOFTWARE\Office2000\custom.mst" /wait /qn'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </upgrade>

  <downgrade cmd='"%SOFTWARE\Office2000\setup.exe" TRANSFORMS="%SOFTWARE\Office2000\custom.mst" /wait /qn'>
    <exit code="1641" reboot="postponed" />
    <exit code="3010" reboot="postponed" />
  </downgrade>

  <remove cmd="MsiExec.exe /X{00010413-78E1-11D2-B60F-006097C998E7} %MSI%">
    <exit code="1641" />
    <exit code="3010" />
  </remove>
</package>

<!--
  NOTES
  1) Use 'setup.exe /A' to create and administrative install point.
  2) Use 'Network Installation Wizard' to create a custom setup.
  3) Put the product key in a file called 'key.txt'.
  4) Extract service release files to folders sr1 and sr2.
  5) Make the sr2 folder read only, else files that are patched will
     dissappear (mso97.dll, msaccess.exe) and make the folder useless.
  6) Uninstall leaves a lot of dirt behind, however when using the default
     install location there will office 2000 stuff here too, so we can't
     just prune the install dirs.
  7) Access 97 requires some work on 64 bit systems, because some hardcoded
     paths are used (%WINDIR%\System32\).
  8) Access 97 might fail to set the workgroup correctly, I'm not sure if this
     will throw an error dialog during setup (which it normally does in
     interactive mode), but this can be fixed by running the workgroup admin
     manually at a later time. Will get fixed later if it appears to be a
     returning issue.
-->
<package
  id="office97pro"
  name="MS Office 97 Professional"
  revision="%version%-0"
  reboot="false"
  priority="9">
  <!--
    priority is lower than office2000, because office2000 install will break
    access 97, which is the only thing I need from office 97. You might be
    able to fix this by changing the Office 97 install path, which will break
    uninstall as defined in this package.
  -->

  <!-- Version number from mso97.dll -->
  <variable name="version" value="8.0.0.5425" />
  <!-- mso97.dll version: 8.0.0.3507 (no SR) -->
  <!-- mso97.dll version: 8.0.0.4202 (SR1) -->
  <!-- mso97.dll version: 8.0.0.5425 (SR2b) -->

  <check type="logical" condition="and">
    <check type="uninstall" condition="exists" path="Microsoft Office 97, Professional" />
    <check type="logical" condition="or">
      <check type="file" condition="versiongreaterorequal" path="%PROGRAMFILES%\Microsoft Office\Office\mso97.dll" value="%version%" />
      <check type="file" condition="versiongreaterorequal" path="%PROGRAMFILES(x86)%\Microsoft Office\Office\mso97.dll" value="%version%" />
    </check>
  </check>

  <!--
    Excuse my French, but Windows doesn't allow use of subcommands (in an easy
    way). The 'usebackq' prevents the need to escape single quotes that define
    the command for 'FOR /F'.
  -->
  <install cmd='%COMSPEC% FOR /F "usebackq tokens=*" %A IN (`type "%SOFTWARE%\Office97\key.txt"`) DO "%SOFTWARE%\Office97\setup.exe" /L Custom\Custom.lst /K "%A" /B2 /QTN' />
  <install cmd='"%SOFTWARE%\Office97\sr1\off97sr1.exe" /Q' />
  <install cmd='"%SOFTWARE%\Office97\sr2\sr2patch.exe" /Q' />

  <upgrade cmd='%COMSPEC% FOR /F "usebackq tokens=*" %A IN (`type "%SOFTWARE%\Office97\key.txt"`) DO "%SOFTWARE%\Office97\setup.exe" /L Custom\Custom.lst /K "%A" /B2 /QTN' />
  <upgrade cmd='"%SOFTWARE%\Office97\sr1\off97sr1.exe" /Q' />
  <upgrade cmd='"%SOFTWARE%\Office97\sr2\sr2patch.exe" /Q' />

  <downgrade cmd='%COMSPEC% FOR /F "usebackq tokens=*" %A IN (`type "%SOFTWARE%\Office97\key.txt"`) DO "%SOFTWARE%\Office97\setup.exe" /L Custom\Custom.lst /K "%A" /B2 /QTN' />
  <downgrade cmd='"%SOFTWARE%\Office97\sr1\off97sr1.exe" /Q' />
  <downgrade cmd='"%SOFTWARE%\Office97\sr2\sr2patch.exe" /Q' />

  <remove cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "x86"   "%PROGRAMFILES%\Microsoft Office\Office\Setup\Acme.exe" /w Off97Pro.STF /UA /QNT' />
  <remove cmd='%COMSPEC% /C IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" "%PROGRAMFILES(x86)%\Microsoft Office\Office\Setup\Acme.exe" /w Off97Pro.STF /UA /QNT' />
</package>

<!--
  NOTES
  1) TODO: some startup job runs - how to remove it?
 -->

<package
  id="uninstall-oe"
  name="Outlook Express Uninstall"
  revision="5"
  execute="once">
  <install cmd='%COMSPEC% /c IF EXIST %windir%\INF\oeaccess.inf RunDll32 advpack.dll,LaunchINFSection %windir%\INF\oeaccess.inf,UninstallOE' />
  <!--
  <install cmd='reg add "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\{89820200-ECBD-11cf-8B85-00AA005B4383}" /t REG_DWORD /v IsInstalled /d 0 /f' />
  <install cmd='reg add "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\{44BBA840-CC51-11CF-AAFA-00AA00B6015C}" /t REG_DWORD /v IsInstalled /d 0 /f' />
  -->
  <install cmd='%COMSPEC% /c IF EXIST "%PROGRAMFILES%\Outlook Express" RD /Q /S "%PROGRAMFILES%\Outlook Express"' />
</package>

</packages>

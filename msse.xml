<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) For version 2, there are now only two installers - one for 32 and another for 64 bit
  2) All installers are named mseinstall.exe - move them to the proper directory
  3) The platform/bitness specific packages now only depend on the generic msse package - they are left in for backwards compatibility
  4) Installer will throw -2147156187 if a reboot is needed before it can installed again - this is NOT success

-->

<packages>

<package
  id="msse"
  name="MS Security Essentials"
  revision="%version%-1"
  reboot="false"
  priority="50">

  <variable name='version' value='2.0.657.0' />
  <variable name='update_interval' value='4' />

  <check type="uninstall" condition="versiongreaterorequal" path="Microsoft Security Essentials" value="%version%" />

  <install cmd='net stop MsMpSvc'><exit code="2" /></install>
  <install cmd='"%SOFTWARE%\Microsoft\MSSE\%PROCESSOR_ARCHITECTURE%\mseinstall.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </install>
  <install cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <install cmd='REG ADD "HKLM\SOFTWARE\Microsoft\Microsoft Antimalware\Signature Updates" /v SignatureUpdateInterval /t REG_DWORD /d %update_interval% /f' />
  <install cmd='net start MsMpSvc'><exit code="2" /></install>

  <upgrade cmd='net stop MsMpSvc'><exit code="2" /></upgrade>
  <upgrade cmd='"%SOFTWARE%\Microsoft\MSSE\%PROCESSOR_ARCHITECTURE%\mseinstall.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </upgrade>
  <upgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <upgrade cmd='REG ADD "HKLM\SOFTWARE\Microsoft\Microsoft Antimalware\Signature Updates" /v SignatureUpdateInterval /t REG_DWORD /d %update_interval% /f' />
  <upgrade cmd='net start MsMpSvc'><exit code="2" /></upgrade>

  <downgrade cmd='net stop MsMpSvc'><exit code="2" /></downgrade>
  <downgrade cmd='"%SOFTWARE%\Microsoft\MSSE\%PROCESSOR_ARCHITECTURE%\mseinstall.exe" /s /runwgacheck'>
    <exit code="-2147156221" />
    <exit code="-2147156213" />
    <exit code="327424" />
  </downgrade>
  <downgrade cmd='%COMSPEC% /c del "%ALLUSERSPROFILE%\Desktop\Microsoft*.lnk"' />
  <downgrade cmd='REG ADD "HKLM\SOFTWARE\Microsoft\Microsoft Antimalware\Signature Updates" /v SignatureUpdateInterval /t REG_DWORD /d %update_interval% /f' />
  <downgrade cmd='net start MsMpSvc'><exit code="2" /></downgrade>

  <remove cmd='"%PROGRAMFILES%\Microsoft Security Client\setup.exe" /x /s' />

</package>


<package
  id="msse_xp_32"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />

</package>

<package
  id="msse_w7_32"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />

</package>

<package
  id="msse_w7_64"
  name="MS Security Essentials"
  revision="99"
  reboot="false"
  priority="50">

  <depends package-id="msse" />

</package>

</packages>

<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) We should be able to detect SSDs and then not run the boot time and scheduled defrag jobs

-->


<packages>

<package
  id="ultradefrag"
  name="Ultra Defragmenter"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="4.4.0" />

  <check type="uninstall" condition="versiongreaterorequal" path="Ultra Defragmenter" value="%version%" />

  <install cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == x86 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.i386.exe" /S /NCRC' />
  <install cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == AMD64 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.amd64.exe" /S /NCRC' />
  <install cmd='%ComSpec% /c if exist "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" copy /b /v /y "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" "%SystemRoot%\system32"' />
  <install cmd='"%SystemRoot%\system32\bootexctrl.exe" /r defrag_native' />
  <install cmd='%ComSpec% /c del /q "%ALLUSERSPROFILE%\Desktop\UltraDefrag.lnk"'>
    <exit code="any" />
  </install>
  <install cmd='schtasks /Delete /TN DefragWeekly /F'>
    <exit code="any" />
  </install>
  <install cmd='schtasks /Create /TN DefragWeekly /RU SYSTEM /SC WEEKLY /D SUN /ST 02:00:00 /TR "udefrag --wait c:"' />

  <upgrade cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == x86 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.i386.exe" /S /NCRC' />
  <upgrade cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == AMD64 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.amd64.exe" /S /NCRC' />
  <upgrade cmd='%ComSpec% /c if exist "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" copy /b /v /y "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" "%SystemRoot%\system32"' />
  <upgrade cmd='"%SystemRoot%\system32\bootexctrl.exe" /r defrag_native' />
  <upgrade cmd='%ComSpec% /c del /q "%ALLUSERSPROFILE%\Desktop\UltraDefrag.lnk"'>
    <exit code="any" />
  </upgrade>
  <upgrade cmd='schtasks /Delete /TN DefragWeekly /F'>
    <exit code="any" />
  </upgrade>
  <upgrade cmd='schtasks /Create /TN DefragWeekly /RU SYSTEM /SC WEEKLY /D SUN /ST 02:00:00 /TR "udefrag --wait c:"' />

  <downgrade cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == x86 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.i386.exe" /S /NCRC' />
  <downgrade cmd='%ComSpec% /c if %PROCESSOR_ARCHITECTURE% == AMD64 "%SOFTWARE%\UltraDefrag\ultradefrag-%version%.bin.amd64.exe" /S /NCRC' />
  <downgrade cmd='%ComSpec% /c if exist "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" copy /b /v /y "%SOFTWARE%\UltraDefrag\ud-boot-time.cmd" "%SystemRoot%\system32"' />
  <downgrade cmd='"%SystemRoot%\system32\bootexctrl.exe" /r defrag_native' />
  <downgrade cmd='%ComSpec% /c del /q "%ALLUSERSPROFILE%\Desktop\UltraDefrag.lnk"'>
    <exit code="any" />
  </downgrade>
  <downgrade cmd='schtasks /Delete /TN DefragWeekly /F'>
    <exit code="any" />
  </downgrade>
  <downgrade cmd='schtasks /Create /TN DefragWeekly /RU SYSTEM /SC WEEKLY /D SUN /ST 02:00:00 /TR "udefrag --wait c:"' />

  <remove  cmd='%ComSpec% /c "%SystemRoot%\UltraDefrag\uninstall.exe" /S /NCRC' />
  <remove  cmd='%ComSpec% /c if exist "%SystemRoot%\UltraDefrag" rmdir /s /q "%SystemRoot%\UltraDefrag"' />
</package>

</packages>

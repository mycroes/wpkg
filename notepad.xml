<?xml version="1.0" encoding="UTF-8"?>

<!--
  NOTES
  1) We remove the plugins to prevent the installer from hanging
-->


<packages>

<package
  id="notepad"
  name="Notepad++"
  revision="%version%-0"
  reboot="false"
  priority="10">

  <variable name="version" value="5.8.7" />

  <check type="uninstall" condition="versiongreaterorequal" path="Notepad++" value="%version%" />
  <check type='logical' condition='or'>
    <check type="file" condition="versiongreaterorequal" path="%ProgramFiles%\Notepad++\notepad++.exe" value="%version%" />
    <check type="file" condition="versiongreaterorequal" path="%ProgramFiles(x86)%\Notepad++\notepad++.exe" value="%version%" />
  </check>

  <install cmd='taskkill /f /im notepad++.exe'><exit code="any" /></install>
  <install cmd='%ComSpec% /c if exist "%ProgramFiles%\Notepad++\plugins" del /f /q "%ProgramFiles%\Notepad++\plugins\*.dll"' />
  <install cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\Notepad++\plugins" del /f /q "%ProgramFiles(x86)%\Notepad++\plugins\*.dll"' />
  <install cmd='"%SOFTWARE%\Notepad\npp.%version%.Installer.exe" /S' />

  <upgrade cmd='taskkill /f /im notepad++.exe'><exit code="any" /></upgrade>
  <upgrade cmd='%ComSpec% /c if exist "%ProgramFiles%\Notepad++\plugins" del /f /q "%ProgramFiles%\Notepad++\plugins\*.dll"' />
  <upgrade cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\Notepad++\plugins" del /f /q "%ProgramFiles(x86)%\Notepad++\plugins\*.dll"' />
  <upgrade cmd='"%SOFTWARE%\Notepad\npp.%version%.Installer.exe" /S' />

  <downgrade cmd='taskkill /f /im notepad++.exe'><exit code="any" /></downgrade>
  <downgrade cmd='%ComSpec% /c if exist "%ProgramFiles%\Notepad++\plugins" del /f /q "%ProgramFiles%\Notepad++\plugins\*.dll"' />
  <downgrade cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\Notepad++\plugins" del /f /q "%ProgramFiles(x86)%\Notepad++\plugins\*.dll"' />
  <downgrade cmd='"%SOFTWARE%\Notepad\npp.%version%.Installer.exe" /S' />

  <remove cmd='taskkill /f /im notepad++.exe'><exit code="any" /></remove>
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles%\Notepad++\plugins" del /f /q "%ProgramFiles%\Notepad++\plugins\*.dll"' />
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles%\Notepad++\uninstall.exe" "%ProgramFiles%\Notepad++\uninstall.exe" /S' />
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\Notepad++\plugins" del /f /q "%ProgramFiles(x86)%\Notepad++\plugins\*.dll"' />
  <remove cmd='%ComSpec% /c if exist "%ProgramFiles(x86)%\Notepad++\uninstall.exe" "%ProgramFiles(x86)%\Notepad++\uninstall.exe" /S' />

</package>

</packages>

<?xml version="1.0" encoding="UTF-8"?>

<!--
NOTES
 1) It might be better to fudge setup.ini instead of removing the Run key
 2) BDM depends on a specific version of the C++ runtime which we force install here. vcruntime installs a newer version that BDM doesn't detect.
-->

<packages>

<package
  id="blackberry_desktop_manager"
  name="BlackBerry Desktop Manager"
  revision="%version%-0"
  reboot="false"
  priority="10"
  execute="always">

  <variable name="version" value="6.1.0" />
  <variable name="vc_id" value="{8D6472BE-E246-4e63-A578-53EDAE1F40AB}" />

  <depends package-id="msxml" />
  <depends package-id="vcruntime" />
  <depends package-id="dotnet3" />

  <check type="uninstall" condition="exists" path="BlackBerry Desktop Software %version%" />

  <install cmd='"%SOFTWARE%\BlackBerry\Desktop Manager\%version%\ISSetupPrerequisites\%vc_id%\vcredist_x86.exe" /q' />
  <install cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Desktop Manager\%version%\BlackBerry Desktop Software.msi"'>
    <exit code="3010" />
  </install>
  <install cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v BlackBerryAutoUpdate /f'>
    <exit code="1" />
  </install>

  <upgrade cmd='"%SOFTWARE%\BlackBerry\Desktop Manager\%version%\ISSetupPrerequisites\%vc_id%\vcredist_x86.exe" /q' />
  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Desktop Manager\%version%\BlackBerry Desktop Software.msi"'>
    <exit code="3010" />
  </upgrade>
  <upgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v BlackBerryAutoUpdate /f'>
    <exit code="1" />
  </upgrade>

  <downgrade cmd='"%SOFTWARE%\BlackBerry\Desktop Manager\%version%\ISSetupPrerequisites\%vc_id%\vcredist_x86.exe" /q' />
  <downgrade cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Desktop Manager\%version%\BlackBerry Desktop Software.msi"'>
    <exit code="3010" />
  </downgrade>
  <downgrade cmd='REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v BlackBerryAutoUpdate /f'>
    <exit code="1" />
  </downgrade>

</package>

<package
  id="blackberry_drivers"
  name="BlackBerry USB and Modem Manager"
  revision="%version%.%minor%-0"
  reboot="false"
  priority="10"
  execute="always">

  <variable name="version" value="6.0.2" />
  <variable name="minor" value="9" />

  <check type="uninstall" condition="versiongreaterorequal" path="BlackBerry USB and Modem Drivers %version%" value="%version%.%minor%" />

  <install cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Drivers\%version%\BlackBerry USB and Modem Drivers_ENG.msi"'>
    <exit code="3010" reboot="postponed" />
  </install>

  <upgrade cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Drivers\%version%\BlackBerry USB and Modem Drivers_ENG.msi"'>
    <exit code="3010" reboot="postponed" />
  </upgrade>

  <downgrade cmd='msiexec %MSI% /i "%SOFTWARE%\BlackBerry\Drivers\%version%\BlackBerry USB and Modem Drivers_ENG.msi"'>
    <exit code="3010" reboot="postponed" />
  </downgrade>

  <remove cmd='msiexec %MSI% /x "%SOFTWARE%\BlackBerry\Drivers\%version%\BlackBerry USB and Modem Drivers_ENG.msi"'>
    <exit code="3010" />
  </remove>

</package>

</packages>
